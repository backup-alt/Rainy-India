- name: Upload to Brain
      shell: powershell
      run: |
        # 1. Grab the URL and remove any accidental leading/trailing slashes
        $RawUrl = "${{ inputs.brain_url }}"
        $CleanUrl = $RawUrl.Trim().TrimStart('/').TrimEnd('/')
        
        Write-Host "Connecting to: $CleanUrl"
        
        $Image = Get-ChildItem screenshot_*.jpg | Select-Object -First 1
        
        if ($Image) {
            $Bytes = [System.IO.File]::ReadAllBytes($Image.FullName)
            $Base64Image = [System.Convert]::ToBase64String($Bytes)
            $Body = @{ image = $Base64Image } | ConvertTo-Json
            
            try {
                # Use Invoke-RestMethod for cleaner JSON handling
                $Response = Invoke-RestMethod -Method Post -Uri $CleanUrl -Body $Body -ContentType "application/json"
                Write-Host "Success! Brain Responded: $($Response | ConvertTo-Json -Compress)"
            } catch {
                Write-Error "Upload Failed: $_"
                exit 1
            }
        }
