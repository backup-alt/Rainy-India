- name: Upload to Brain (JSON Mode)
      shell: powershell
      run: |
        Write-Host "--- Encoding & Sending Evidence ---"
        $ServerUrl = "${{ inputs.brain_url }}"
        
        # Get the first screenshot found
        $Image = Get-ChildItem screenshot_*.jpg | Select-Object -First 1
        
        if ($Image) {
            Write-Host "üöÄ Processing $($Image.Name)..."
            
            # Use Python to handle the complex JSON/Base64 sending
            python -c "
import requests
import base64
import json
import sys

try:
    # 1. Read image and convert to Base64
    with open('$($Image.Name)', 'rb') as img_file:
        b64_string = base64.b64encode(img_file.read()).decode('utf-8')

    # 2. Prepare JSON payload
    payload = {'image': b64_string}
    headers = {'Content-Type': 'application/json'}

    print('üì° Sending to Zoho...')
    response = requests.post('$ServerUrl', json=payload, headers=headers)

    print('‚úÖ Response Code:', response.status_code)
    print('‚úÖ Response Body:', response.text)

    if response.status_code != 200:
        sys.exit(1)

except Exception as e:
    print('‚ùå Error:', str(e))
    sys.exit(1)
"
        } else {
            Write-Warning "‚ö†Ô∏è No screenshots found to upload."
        }
