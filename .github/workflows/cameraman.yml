name: News Cameraman (Self-Hosted Windows)

on:
  workflow_dispatch:
    inputs:
      duration:
        description: 'How long to watch? (seconds)'
        default: '60'

jobs:
  watch-news:
    runs-on: self-hosted
    timeout-minutes: 360

    steps:
    - name: Get Stream & Capture
      shell: powershell
      run: |
        Write-Host "üîç Finding Thanthi TV Stream..."
        
        # 1. Get the Stream URL using yt-dlp
        $StreamUrl = yt-dlp --extractor-args "youtube:player_client=ios" -f 94/93/95/best -g "https://www.youtube.com/@ThanthiTV/live"
        
        if (-not $StreamUrl) {
           Write-Error "‚ùå Could not find stream URL! Check if yt-dlp is installed."
           exit 1
        }

        Write-Host "‚úÖ Found Stream: $StreamUrl"
        
        # 2. Start Capture (Cropped for Ticker)
        Write-Host "üì∏ Starting Capture..."
        ffmpeg -headers "User-Agent: Mozilla/5.0 (iPhone; CPU iPhone OS 16_0 like Mac OS X)" -i "$StreamUrl" -vf "fps=0.4,scale=854:480,crop=854:120:0:360" -t ${{ inputs.duration }} -q:v 5 screenshot_%04d.jpg

    - name: Upload Evidence
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: thanthi-tv-evidence
        path: "*.jpg"
