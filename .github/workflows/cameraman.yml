- name: Upload to Brain
      shell: powershell
      run: |
        # We define the URL clearly here to avoid the /https:/ error
        $TargetUrl = "https://sherwin-60052075848.development.catalystserverless.in/server/ultra_brain/process"
        
        Write-Host "Connecting to: $TargetUrl"
        
        $Image = Get-ChildItem screenshot_*.jpg | Select-Object -First 1
        
        if ($Image) {
            Write-Host "Sending image: $($Image.Name)"
            $Bytes = [System.IO.File]::ReadAllBytes($Image.FullName)
            $Base64Image = [System.Convert]::ToBase64String($Bytes)
            $Body = @{ image = $Base64Image } | ConvertTo-Json
            
            try {
                $Response = Invoke-RestMethod -Method Post -Uri $TargetUrl -Body $Body -ContentType "application/json"
                Write-Host "Success! Brain found text: $($Response.text)"
            } catch {
                # This will show us the EXACT server error if it fails again
                $ErrorMessage = $_.Exception.Response.GetResponseStream()
                $Reader = New-Object System.IO.StreamReader($ErrorMessage)
                Write-Error "Server Response: $($Reader.ReadToEnd())"
                exit 1
            }
        }
